<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="乘风破浪会有时,直挂云帆济沧海">
<meta property="og:type" content="website">
<meta property="og:title" content="jaderYang&#39;s Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="jaderYang&#39;s Notes">
<meta property="og:description" content="乘风破浪会有时,直挂云帆济沧海">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jaderYang&#39;s Notes">
<meta name="twitter:description" content="乘风破浪会有时,直挂云帆济沧海">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>jaderYang's Notes</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jaderYang's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just do IT</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/20/ASO简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jaderyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jaderYang's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/ASO简介/" itemprop="url">ASO入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T07:32:47+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS周边/" itemprop="url" rel="index">
                    <span itemprop="name">iOS周边</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>事先声明下，ASO在本质上来讲是互联网运营需要做的事，我们了解ASO主要是丰富及完善下我们的知识体系，自身开发个人app的时候也可以自己做下简单的ASO，毕竟做与不做差距还是很大的。</p>
<h3 id="一、了解ASO"><a href="#一、了解ASO" class="headerlink" title="一、了解ASO"></a>一、了解ASO</h3><h4 id="1-ASO是什么"><a href="#1-ASO是什么" class="headerlink" title="1.ASO是什么"></a>1.ASO是什么</h4><p>ASO 全称为 App Store Optimization ,翻译过来是应用商店优化，包括ios、安卓及其他平台如uwp、steam等的优化。但是说到ASO大多数指的还是苹果应用市场的优化，这也是广义上的ASO。 而搜索优化是目前ASO最重要的部分，所以大家说的ASO通常指狭义上的“应用商店搜索优化”(App Store Search Optimization).</p>
<h4 id="2-为什么要做ASO"><a href="#2-为什么要做ASO" class="headerlink" title="2.为什么要做ASO"></a>2.为什么要做ASO</h4><p>自2015年开始，ASO进入高速发展的时期，到了2016年已经成为app必备的主要推广方式之一。</p>
<p>目前互联网红利正在消失，单位获客成本一直在涨。 相对于其他的推广渠道，应用市场在获客方面有着自己的特点和优势。</p>
<blockquote>
<p>关于互联网红利，引用美团CEO王兴的一段话：　　“从宏观角度看，对于整个中国的互联网也是刚刚进入‘下半场’。之前中国互联网的发展，在很大程度上靠的是人口红利，不管是早期PC网民的迅速增加，还是过去几年移动互联网用户的激增，大家发展的方式哪怕粗糙一点、成本高一点都不要紧，因为用户在快速增长，每年卖几亿部智能手机，大家的业务跟着水涨船高。”王兴如是说，“但是现在可以看到，这个时代已经过去了，智能手机的年销量已经不增长了，总体网民的增长也大幅趋缓。这个时候两条路：要不开拓海外市场，可能还有更多用户，但是国际化是非常不容易的事情；要不你就得精耕细作，把原有的用户服务得更好，通过每个用户创造更多的价值。”</p>
</blockquote>
<p>首先几乎所有手机安装有最少一个的应用市场，而大多数App的下载都无法绕过应用市场。如此大的量级是无法忽视的。</p>
<p>其次，大多数的渠道推广逻辑是，先展示广告，受众看到之后才会产生下载意愿，这两步之间的损耗是非常大的，即很多人看到广告后都不会去下载。而应用市场则是在用户想要去下载App时，已经产生下载意愿后，再向他们进行App推荐。</p>
<p>而且关键词的搜索优化可以帮助开发者实现在用户进行某些特殊搜索行为时展示自家App。苹果自身的搜索广告甚至支持接入搜索广告的API,追踪到某个词带来的用户有着什么样的后续行为。如：通过关键词A而来的用户，活跃度或者留存率比其他词高，那么这个词就值得投入更多的成本去优化。</p>
<h4 id="3-ASO的原理、目标、优化流程"><a href="#3-ASO的原理、目标、优化流程" class="headerlink" title="3.ASO的原理、目标、优化流程"></a>3.ASO的原理、目标、优化流程</h4><p>ASO的原理是，分析App Store对于产品各维度的考量，包括App Store的运行机制与苹果用户的下载习惯，有计划的提升这些参数指标，从而获取自然曝光和用户流量。</p>
<p>App Store的运行机制是其内部的各项算法，如：下载量对排名的影响、账号权重、榜单更新时间等都影响着ASO的效果</p>
<p>ASO的优化目标很明确，就是提升App在 App Store的自然下载量。</p>
<p>优化流程。有一个公式为:<strong>下载量 = 展示量 * 下载转化率</strong>。 所以ASO优化可以从两个方面入手，1.提高展示量；2.提升转化率。对于展示量，App 在App Store的展示位置主要有三个：排行榜、精品推荐、关键词搜索。前两者位置很少，一般App都上不了，而关键词搜索的曝光几率最高，流量也最大<br>。苹果转化率主要受App在App Store展示的形象影响，其中：标题、图标、截图、评论等内容都是关键的要素。</p>
<h3 id="二、ASO的优化方面及具体实现"><a href="#二、ASO的优化方面及具体实现" class="headerlink" title="二、ASO的优化方面及具体实现"></a>二、ASO的优化方面及具体实现</h3><p>####1.搜索优化</p>
<p>用户通过 App Store的搜索引擎搜索指定关键词，发现并下载App的行为称之为”搜索下载”。而在这一过程中，开发者利用App Store的检索和排名规则，提高App的曝光率，下载转化率等一系列行为，便是”搜索优化”。</p>
<p>首先看几个数据：</p>
<blockquote>
<ul>
<li>据2016年苹果官方数据显示65%的用户通过搜索功能获取App</li>
<li>关键词搜索结果前三名可以瓜分70%以上的流量。</li>
<li>App store中App已经超过200w，而App Store榜单仅仅显示前200名。榜单竞争激烈，榜单优化成本非常高。搜索结果排名相对容易操作。</li>
</ul>
</blockquote>
<p>因此，在App Store的推广中，搜索优化已经成为必不可少的重要一环。</p>
<p>搜索优化主要从两点出发：1.关键词覆盖量；2.关键词排行;</p>
<h5 id="关键词覆盖优化"><a href="#关键词覆盖优化" class="headerlink" title="关键词覆盖优化"></a>关键词覆盖优化</h5><p>关键词来源及权重： 标题 &gt; 关键字 &gt; 分类、开发商、内购项目</p>
<p>目前审核者对于标题的要求越来越严格，2016年9月苹果将应用标题部分限制由255字节变成了50个字符，且标题中添加竞品词、无关词、堆砌关键词等很容易被拒。所以标题部分的可操作性越来越小。而关键字部分的限制是100字符，可操作性远大于标题。所以针对覆盖优化方面，我们着重优化关键字的部分。</p>
<p>首先分析并监控自己App的关键词，可以了解关键词的覆盖总量、覆盖数量增减、关键词当天排名、关键词搜索指数等信息，不仅能掌控推广效果，而且能凭借这些信息，及时收录有效关键词，替换带量效果不佳的关键词。从而制定出一套关键词覆盖方案。（借助<a href="https://aso100.com/" target="_blank" rel="noopener">ASO100</a>,讲解关键词的监控。)</p>
<p>其次可以通过关键词、竞品覆盖关键词等扩展关键词词库。通过操作关键词分组可以在下次提交设置关键字的时候，优化出更好的100字符的关键字。详细操作分4步：1.添加应用；2.创建词库（三种方式–扩展关键字、竞品词库、选择已覆盖关键字）3.进入关键字词库，组合出新的关键字集合；4.根据优化意见优化所选项。（详细操作见<a href="https://aso100.com/" target="_blank" rel="noopener">ASO100</a>中关键字优化工具）</p>
<p>并不是说关键词覆盖数量越多就代表ASO优化效果越好，下面介绍几种影响关键词覆盖质量的因素：</p>
<p>1.关键词属性。<br>从搜索优化的角度来划分，关键词可分为：品牌词、行为词、竞品词、功能词、行业词、人群词、热搜词等。通常我们将优化的重点放在品牌词、行为词、竞品词和功能词上。</p>
<p>在App上线初期，品牌还没有知名度的时候，优化重点应该放在功能词、行为词及竞品词上效果更好。当公司及成品具有一定的知名度了，这时候就应该将品牌词作为优化重点之一了。</p>
<p>需要特别注意的是：竞品词最好放在关键字域里，像我们App更保险的做法是稍微改动下，防止被拒。</p>
<p>2.搜索指数</p>
<p>搜索指数指的是关键词在App store的搜索热度。搜索指数越高代表关键词搜索次数越多，流量越大。4605是个特殊搜索指数，很多地方说它代表有效的关键词指数，&gt;=4605的关键词称为有效关键词。</p>
<p>3.竞争度</p>
<p>指在某一关键词下，针对搜索排名所展开的竞争的激烈程度。重要的判断标准是，某关键词下的搜索结果数，比如我们App做的最好的关键词–物流。</p>
<p>通常情况下，高搜索指数以及低竞争度的关键词是最佳的选择，它们能极大的提高应用被用户看到的概率，从而增加应用被下载的机会。</p>
<p>4.相关度</p>
<p>不要在不相关的关键词上下功夫，比如直播去年很火，作为一个物流类App，花大成本提高搜索排行，提高了展示量，但是转化率会非常低。这就得不偿失了。</p>
<p>所以，针对高搜索指数热词，若竞争强度高，且相关性不强，那就应该果断放弃。</p>
<p>#####关键词排行优化<br>通俗来讲，“关键词覆盖优化”是指最大限度的让App出现在更多关键词的搜索结果中；而“关键词排名优化”指的是竟可能的提升App在某个/某些关键词下的搜索排名，让App获取更多流量。</p>
<p>影响关键词排名优化的因素：</p>
<ul>
<li><p>搜索下载量 – 搜索下载量是指通过搜索指定关键词所形成的下载量。 搜索下载量是影响搜索排名最重要的因素。其中下载行为排行权重为： 付费用户下载 &gt; 普通用户下载 &gt; 虚假用户下载（可能会被苹果处罚）。</p>
</li>
<li><p>应用元数据 – 应用元数据(标题、图标、截图、预览视频、简介、评论等），均能导致用户进入App详情，可提高转化率，从而提升下载量。</p>
</li>
<li><p>用户的搜索行为及使用行为 – 用户在搜索关键词以及查看应用详情、下载等后续操作都可以称为用户搜索行为，在苹果的搜索和排名机制中，对用户所做出的搜索行为如：某关键词下用户查看某款App的频度、用户打开该App详情与评论等页面的次数，及在这些页面停留的时长等都进行了统计。另外用户的使用行为如：用户的活跃度、活跃用户比例、用户留存等。这些因素都会对搜索排行产生影响目前的权重相对较低。但是值得注意的是，苹果为了App Store内部生态健康发展，在不断加强DAU（日活跃用户数量）等因素的权重。</p>
</li>
</ul>
<p>排行优化的主要方式有：</p>
<ul>
<li><p>优化前期：若自然量小， 建议在进行关键词覆盖优化的基础上，重点挖掘长尾词（网站上的非目标关键词但与目标关键词相关的也可以带来搜索流量的组合型关键词，如对于目标关键词是物流来说货运物流就是长尾关键词），尽可能的去趁量。若已经有了一定量的自然量，则建议在优化覆盖量的基础上，重点关注行业词、竞品词。</p>
</li>
<li><p>优化中期：根据前期的优化经验，挑选出带量关键词，并进行重点维护，提升其关键字搜索排名。 此外还需重点关注行业词、竞品词等，并通过多轮的覆盖优化，进一步扩充有效关键词库。</p>
</li>
<li><p>成熟期：所谓成熟期即重点优化的关键词排名、带量效果已经稳定。此时，应该进一步提高有效关键字的排名。重点关注竞品词，行业词，并扩展出更多能带量的有效关键词。</p>
</li>
</ul>
<h4 id="2-榜单优化"><a href="#2-榜单优化" class="headerlink" title="2.榜单优化"></a>2.榜单优化</h4><p>榜单优化是ASO的主要手段之一，通常情况下，榜单优化主要针对的事App在App Store免费总榜/分榜，付费总榜/分榜的排名提升。</p>
<p>目前，在App Store的哥哥榜单中，竞争最激烈的事免费总榜。除此之外，游戏、理财等分榜的竞争也非常激烈。</p>
<p>榜单优化有利也有弊。首先，榜单展示位置非常明显，如果能在榜单中占据有效位置，那品牌的曝光率和带量效果将十分可观。 但是，榜单的缺点也很明显：有效位置少，大部分流量被排名靠前的App瓜分(例如新买的手机，想装App，可能就在前50里面找了）。 巨头林立，竞争激烈，而且维持当前排名的难度和成本也较高，性价比低。</p>
<p>榜单排名优化的方式</p>
<ul>
<li><p>增加下载量 – 增加下载量是榜单优化最重要也是最直观的方式，免费版和付费包都可以主要依靠下载量来进行优化。</p>
</li>
<li><p>更换榜单分类 – App Store有25个分类榜，除了儿童之外，其他24个可由开发者自由选择。我们App所处的商务类及生活榜、购物榜等都是竞争激烈的，比如教育榜单等比较冷门的榜单中提升排名相对容易。可以根据自身App特性及目标人群，选择更合适的App类别。</p>
</li>
<li><p>付费转免费 – 限免和长期免费，对于已经拥有一定曝光度和品牌影响力的App来说，这两种方式能在短期内几种吸引用户试用，并对用户的口碑传播有正向引导效果。</p>
</li>
</ul>
<p>警告：切勿尝试苹果眼里禁止的违规手段 – 刷榜。 虽然这种方式能让App快速到达榜单比较高的位置，但是下架风险极大。按照目前的审核制度以及越来越严格的审核风格，基本能达到“逢刷必下”。</p>
<h4 id="3-转化率优化"><a href="#3-转化率优化" class="headerlink" title="3.转化率优化"></a>3.转化率优化</h4><p>通过前面，我们已经知道了转化率是用户通过App Store榜单展示，搜索展示或通过苹果其他曝光的展示，到进行下载行为的比率。</p>
<p>转化率是考核ASO的重要指标，基本上转化率的高低可以直接判定优化行为的ROI(投资回报率).</p>
<p>影响转化率的主要因素有：</p>
<ul>
<li>标题</li>
<li>图标</li>
<li>描述</li>
<li>评论评分</li>
<li>截图</li>
<li>视频预览</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/13/xcode-bugs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jaderyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jaderYang's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/13/xcode-bugs/" itemprop="url">靠玄学解决的iOS开发中的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-13T18:24:00+08:00">
                2018-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS周边/" itemprop="url" rel="index">
                    <span itemprop="name">iOS周边</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>2018年03月13日</em><br><strong>Xcode注释快捷键瓦特了</strong>，看了下设置里面key bindings没有冲突，忍着耐心从别的类copy过注释来然后改。 今天中午牺牲午睡时间来弄弄。<br>先百度,大多数给的方案是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/libexec/xpccachectl。</span><br></pre></td></tr></table></figure></p>
<p>但是High Sirra版本没有这个命令。神特么尴尬。</p>
<p>还是去Google吧：<br>玄学方案：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">去Application文件夹修改Xcode的名字;再打开Xcode。</span><br><span class="line">再改回去(随便你改不改)。</span><br><span class="line">OK啦。</span><br></pre></td></tr></table></figure></p>
<p>不多说，继续写bug去了。</p>
<hr>
<p><em>–未完待续</em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/16/work-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jaderyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jaderYang's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/work-tools/" itemprop="url">个人日常工作使用的工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T18:24:00+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工作/" itemprop="url" rel="index">
                    <span itemprop="name">工作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有些人会好奇一个iOS开发每天工作的一些工具和工作流程是什么。“工欲善其事，必先利其器”，这句话从小就影响着我。所以今天我就介绍下我现在所在的团队和我自己比较喜欢的一些工具吧。作为分享，也作为自己收集，方便下次能搭建出一个熟悉的工作环境。</p>
<h2 id="开发设备"><a href="#开发设备" class="headerlink" title="开发设备"></a>开发设备</h2><p>公司给员工配备的是 15 寸的 MBP (8GB内存，250GB硬盘) 和一台 27 寸的外接显示器。勉强够用。便以速度差强人意，还是家里自己的iMac用着比较爽。</p>
<h2 id="个人偏好"><a href="#个人偏好" class="headerlink" title="个人偏好"></a>个人偏好</h2><h3 id="Xcode"><a href="#Xcode" class="headerlink" title="Xcode"></a>Xcode</h3><p>IDE 我选择 Xcode。 听说高手都是用记事本编程的，本菜鸟只能选择又大又笨重的 Xcode 。主要有下面两个方面的原因：</p>
<pre><code>1. 代码补全。由于达不到人肉记忆所有 API 的境界，所有我还是依赖代码自动补全帮我提高开发效率。对于开箱即用， 苹果钦点的 IDE， Xcode 还是最稳妥的选择。
2. 有Storyboard开发的， 至今为止 Xcode 是编辑和管理 Interface Builder 文件最佳的选择。
</code></pre><p>当然也有朋友给我安利过 AppCode, 各种奇淫技巧帮助开发优化代码等，但是我的内心毫无波动，忠诚如我。</p>
<p>看博客有提到，今年 Apple 软件上的策略是稳定性为主，而不是急于迭代新的feature。 希望 WWDC 过后， Xcode能够更加稳定高效。</p>
<h3 id="Atom"><a href="#Atom" class="headerlink" title="Atom"></a>Atom</h3><p>平时需要写些node.js、python、react-native的东西，一个全能型的编辑器是不可或缺的。大神专用的vim我这辈子是不可能去专研的啦。Mac平台推荐率较高的就是 Sublime 和 Atom 了。 而选择 Atom 主要有下面三个原因：</p>
<pre><code>1. Atom 对多语言的适配性特别强，全能王。
2. Atom 是开源的，稳定性和生态都非常好。
3. 新手时期在 windows 平台用 Sublime 感觉复杂难用。（第一映像不太好)
</code></pre><p>顺便介绍下我用的插件：</p>
<pre><code>* minimap      #仿Sublime 全文缩略图
* markdown-writer #markdown写作插件
* hyperclick #点击跳转函数/变量/模块
* highlight-selected  #选中高亮
* jshint       #代码规范检查
* 各种语言代码补全
</code></pre><h3 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a>Charles</h3><p>这个大概已经被无数人推荐过了。 Charles 是一个网络代理工具，可以让你查看所有的 HTTP 甚至 Socket 请求， 用来确认开发及测试时网络方面的问题。 另外，它还能完成本地映射 response 或者截取请求更改等等一系列骚操作。强大而且实用。</p>
<h3 id="Navicat"><a href="#Navicat" class="headerlink" title="Navicat"></a>Navicat</h3><p>这个作为移动端人员可能比较陌生。 Navicat 是一款数据库管理工具, 可以让你查看及修改数据库中的数据。Navicat 设计简单，易于使用，我们平时开发及自测可以通过它来验证数据的准确性。简约而不简单。</p>
<h3 id="iTerm2"><a href="#iTerm2" class="headerlink" title="iTerm2"></a>iTerm2</h3><p>非常好用的终端工具。我是个比较喜欢终端操作的选手，我平时操作 git 也是通过命令行，项目多了后用苹果自带的终端会出现满屏都是小窗口，有种打开xx网站满屏弹窗的赶脚。 iTem2 可以通过快捷键非常快捷的在当前 window 下创建页签，而且主题样式也很多，是我相当中意的一款 App。<br>如果要把这电脑上的 App 删的只剩下一个，我会选择留下它， 然后通过命令行装回其他所有的应用（皮一下）。</p>
<h3 id="其他杂项"><a href="#其他杂项" class="headerlink" title="其他杂项"></a>其他杂项</h3><p>其他还有些工具，使用频率并没有上面那些频繁，但是也是我的日用品，也一并介绍一下。</p>
<ul>
<li>滴答清单: 一款非常好用的任务管理软件， 可以创建文件夹、日期提醒、任务、子任务等。团队协作时，不断会有小任务抛过来，如果不是特别要紧的，可以记录在清单里，完成手头的事后再去一个个清。清完特别有成就感。</li>
<li>MacDown: 用 MD 写文章时我会用它，因为可以实时预览效果。界面非常简单，全屏无干扰的写作 会非常专注。</li>
<li>Evernote: 笔记软件，平时碎屏整理，读书笔记都可以丢在里面，分门别类，可以多个端同步数据。</li>
<li>xscope: 屏幕尺子，可以方便测量</li>
<li>网易云音乐: 带上耳机，我地板都能抖穿。</li>
</ul>
<h2 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h2><h3 id="策划，会议记录，-文档管理"><a href="#策划，会议记录，-文档管理" class="headerlink" title="策划，会议记录， 文档管理"></a>策划，会议记录， 文档管理</h3><p>公司采用的是 Confluence 搭建的 wiki。各部门都有自己的 wiki 工作空间，各人也有自己的私人空间。平时团队交流、会议纪要、测试回归 case、需求变更文档 等，都会记录在上面，用 wiki 的好处在于，所有的更改都是有迹可循的，包括开发排期，需求变更。但是主要约束的还是开发组同志们任务是否延期，需求组的一个文档改个几十次依然是家常便饭。</p>
<h3 id="issue-追踪"><a href="#issue-追踪" class="headerlink" title="issue 追踪"></a>issue 追踪</h3><p>公司采用的是自架的 JIRA. 我们不仅用他来做 issue tracking， 也变相的相当于开发进度管理： 产品创建 Spring 并发布需求点到个组 Manager， Manager 评估和分解任务后，为每个小任务创建 issure,然后分配给对应的负责人；负责人在实现后变更 issue 状态，并打上版本号， 最后 QA 部门验证后关闭 issue。 这样，只需要看当前版本剩余的 issue 数量，就可以大体预估发布时间了。</p>
<h3 id="交流"><a href="#交流" class="headerlink" title="交流"></a>交流</h3><p>全公司使用钉钉作为聊天工具。钉钉作为阿里提供的企业版聊天工具，提供了可以嵌入公司组织架构，打卡，请假等流程，也可以手动编程加入各种机器人。能满足公司日常交流及少部分行政流程。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/08/datasource-protocol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jaderyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jaderYang's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/08/datasource-protocol/" itemprop="url">自定义控件 -- 使用DataSource</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-08T18:24:00+08:00">
                2017-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我是个记性比较差的人，做ios开发时间也不短了。在实际开发的时候，有些基础的东西常常会跑网上查了然后piapiapia实现，最后自己没理解透彻，给人讲也是讲不清楚。</p>
<p>开始写点东西主要有两个原因：</p>
<ol>
<li>目前自己独立开发一个app，遇到的坎蛮多，一步步跨过，想留下点脚印；</li>
<li><code>WWDC2017</code>要开了，<code>swift3.1</code>也要发布了，感觉稳定性应该会大步提升，之后我肯定会转向那边，写些知识点，之后学习swift的时候方便对照验证。</li>
</ol>
<p>最后一句话送给somebody – <em>It’s never too late to start</em>.</p>
<h2 id="遇坎场景"><a href="#遇坎场景" class="headerlink" title="遇坎场景"></a>遇坎场景</h2><p>今天写一个界面的时候，需要自定义个segment，按以前的思路来：</p>
<ol>
<li>最直接，最快，最省事的做法 – 按现在的美工图来，有几个选项写几个选项。控件所有内容写死。</li>
<li>考虑到后期有数据变更，常用的做法 – 在segment初始化的时候，自定义<code>init</code>方法把参数带过去。</li>
</ol>
<p>我原本打算用方法2直接开干了。但是想到<code>UITableView</code>能那么优雅的通过<code>UITableViewDataSource</code> 确定行数，能定制每行视图，能定制每个<code>section</code>的<code>title</code>… 便思考了下如何实现一个可由<code>DataSource</code>控制的控件。</p>
<h2 id="求索过程"><a href="#求索过程" class="headerlink" title="求索过程"></a>求索过程</h2><h4 id="DataSource是什么"><a href="#DataSource是什么" class="headerlink" title="DataSource是什么?"></a><code>DataSource</code>是什么?</h4><p><code>DataSource</code>的本质是 遵循了特定协议（<code>Protocol</code>）的对象。它管理着app显示的内容。拿最常用的<code>UITableView</code>举例，在服装列表界面需要用<code>UITableView</code>来实现一系列需要展示的商品，我们常常会写:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:tableView];</span><br></pre></td></tr></table></figure>
<p>这时候<code>self</code>这个<code>ViewController</code>就是<code>tableView</code>的<code>dataSource</code>。当然前提是<code>ViewController</code>遵循了<code>UITableViewDataSource</code>协议，而且在<code>ViewController</code>内重写了<code>UITableViewDataSource</code>必须实现（<code>@ required</code>标注下）的方法。</p>
<p>协议在此处的作用就是规定<code>DataSource</code>必须实现的方法以及其他可选择实现方法的格式。如：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UITableViewDataSource</span>&lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="comment">//必须重写</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">//需要展示的section的数量</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"><span class="comment">//需要展示的单个cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">//选择性重写</span></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">//每个section下有几行数据 eg:如果不重写 则默认为1</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView;</span><br><span class="line"></span><br><span class="line"><span class="comment">//截取部分 其余的省略。。。。。</span></span><br></pre></td></tr></table></figure>
<p>所以只要在<code>ViewController</code>中重写上诉的<code>@required</code>方法下的两个方法，根据自己的界面需求，返回相应的结果，即可以定制自己的tableview了。</p>
<p>知道了<code>dataSource</code>的作用，那<code>dataSource</code>具体如何工作的呢？为什么在<code>ViewController</code>里遵循协议重写了<code>numberOfSectionsInTableView</code>方法就能定制<code>tableView</code>的<code>section</code>数量？</p>
<p>####<code>DataSource</code>是如何实现的？</p>
<p><code>Protocol</code>是对象间通信的方式之一，其他方式还有<code>Taget/Action</code>, <code>KVO</code> ,<code>Block</code>, <code>Notification</code>, 之后可能会写个笔记详细记录下各自的使用情景。</p>
<p>通信总是要事件去触发的，比如接受到某个通知， 比如点击某个按钮，再比如某个属性值变化了。。。</p>
<p>对于<code>Protocol</code>来说一般某事件触发时，比如针对<code>UITableViewDelegate</code>,点击了某个<code>cell</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//纯属自己猜想 假设tableview源码里面的实现</span></span><br><span class="line">- (<span class="keyword">void</span>)cellClickAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="comment">//1.判断VC是否遵循了UITableViewDelegate(也就是 tableview.delegate = self;这句有没有写。</span></span><br><span class="line">    <span class="comment">//2.判断VC是否重写了didSelectRowAtIndexPath方法。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:didSelectRowAtIndexPath:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate tableView:<span class="keyword">self</span> didSelectRowAtIndexPath:indexPath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么问题来了，<code>UITableViewDataSource</code>中方法的触发点在哪里呢？ 在<code>numberOfSectionsInTableView</code>方法处加入断点可以看到，除了初始化的时候执行了，<code>[TableView reloadData]</code>的时候也执行了。所以可以猜想，<code>tableView</code>在第一次显示的时候,自己调用了<code>reloadData</code>。 为了更细化的找出触发点，我自定义了一个<code>UITableView</code>的子类，来查看详细的执行过程。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CCCustomTableView</span> : <span class="title">UITableView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CCCustomTableView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CCCustomTableView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToSuperview&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> didMoveToSuperview];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToWindow&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> didMoveToWindow];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)layoutIfNeeded&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> layoutIfNeeded];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setDataSource:(<span class="keyword">id</span>&lt;<span class="built_in">UITableViewDataSource</span>&gt;)dataSource&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> setDataSource:dataSource];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setDelegate:(<span class="keyword">id</span>&lt;<span class="built_in">UITableViewDelegate</span>&gt;)delegate&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> setDelegate:delegate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)reloadData&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    [<span class="keyword">super</span> reloadData];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后写个<code>ViewController</code>容器来实现它</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CCTableViewDatasouceTestViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CCTableViewDatasouceTestViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CCCustomTableView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CCTableViewDatasouceTestViewController</span> ()&lt;<span class="title">UITableViewDelegate</span>, <span class="title">UITableViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CCTableViewDatasouceTestViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    CCCustomTableView *tableView = [[CCCustomTableView alloc] initWithFrame:<span class="built_in">CGRectZero</span> style:<span class="built_in">UITableViewStylePlain</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:tableView];</span><br><span class="line">    [tableView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.edges.equalTo(tableView.superview);</span><br><span class="line">    &#125;];</span><br><span class="line">    tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">    tableView.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLayoutSubviews&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLayoutSubviews];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>])];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>])];</span><br><span class="line">    &#125;</span><br><span class="line">    cell.textLabel.text = <span class="string">@"尺寸-Test"</span>;</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行 看到控制台里的输出信息</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3190264-785ed1f4f45f72a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="blog_pic_1.png"></p>
<p>可以看到，<code>dataSource</code>中重写<code>Protocol</code>定义的方法有两个地方触发:</p>
<ol>
<li><code>tableView</code>的 <code>didMoveToWindow</code>(<em>当<code>view</code>的<code>window object</code> 改变的时候触发</em>)  触发后直接执行了三遍。</li>
<li><code>tableView</code>的<code>layoutSubviews</code> (<em>当<code>view</code>重新布局子视图的时候</em>) 触发后执行<code>reloadData</code>，然后执行了一遍。</li>
</ol>
<hr>
<h5 id="知识扩展。"><a href="#知识扩展。" class="headerlink" title="知识扩展。"></a><a name="知识扩展">知识扩展</a>。</h5><p><code>layoutSubviews</code>的触发条件。<a href="http://www.superqq.com/blog/2015/07/27/ioskai-fa-zhi-layoutsubviewsde-zuo-yong-he-diao-yong-ji-zhi/" target="_blank" rel="noopener">详情点击</a></p>
<blockquote>
<ol>
<li>直接调用<code>setLayoutSubviews</code>。（这个在上面苹果官方文档里有说明）</li>
<li><code>addSubview</code>的时候。</li>
<li>当<code>view</code>的<code>frame</code>发生改变的时候。</li>
<li>滑动<code>UIScrollView</code>的时候。</li>
<li>旋转<code>Screen</code>会触发父<code>UIView</code>上的<code>layoutSubviews</code>事件。</li>
<li>改变一个<code>UIView</code>大小的时候也会触发父<code>UIView上</code>的<code>layoutSubviews</code>事件。</li>
</ol>
</blockquote>
<p>ps： 我测试了下，把一个无子视图的<code>view</code>添加到父视图，<code>view</code>的 <code>layoutSubviews</code>会被触发。</p>
<hr>
<p>为了进一步确认是否是这两个方法内的调用，我将<code>CCCustomTableView</code>中的这两个方法的<code>super</code>调用注释掉，会发现重写的<code>Protocol</code>中的方法不再执行， 界面当然也不能正常显示。</p>
<p>ps: 在 <code>didMoveToWindow</code> 中的三次调用目前我还无法理解，不知道有何作用，有大神知道麻烦解惑一下。而且我发现，单独注释掉 <code>didMoveToWindow</code>中的super调用，视图依然能够正常运行，我这边先选择性跳过了。</p>
<p>我还发现 <code>layoutSubviews</code>调用了两次, 只有第一次主动调用<code>reloadData</code>,所以我大致的模拟下<code>UITableView</code>中关于这部分源码的实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一次加载时主动调用reloadData</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_hasLayouted) &#123;</span><br><span class="line">        [<span class="keyword">self</span> reloadData];</span><br><span class="line">        _hasLayouted = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重新加载数据的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)reloadData&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> sectionsNum;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.dataSource &amp;&amp; [<span class="keyword">self</span>.dataSource respondsToSelector:<span class="keyword">@selector</span>(numberOfSectionsInTableView:)]) &#123;</span><br><span class="line">        sectionsNum =  [<span class="keyword">self</span>.dataSource numberOfSectionsInTableView:<span class="keyword">self</span>];</span><br><span class="line">        <span class="keyword">if</span> (!sectionsNum) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.numberOfSections = sectionsNum;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *rowsNum =@[].mutableCopy;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.dataSource &amp;&amp; [<span class="keyword">self</span>.dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:numberOfRowsInSection:)]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sectionsNum; i++) &#123;</span><br><span class="line">            <span class="built_in">NSInteger</span> rowNum = [<span class="keyword">self</span>.dataSource tableView:<span class="keyword">self</span> numberOfRowsInSection:i];</span><br><span class="line">            [rowsNum addObject:@(rowNum)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//默认为1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sectionsNum; i++) &#123;</span><br><span class="line">            [rowsNum addObject:@<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Protocol其他方法调用</span></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据数据源提供的数据 更新视图</span></span><br><span class="line">    [<span class="keyword">self</span> updateView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样在视图第一次加载或者之后拿到网络数据想更新视图时候， 就能根据<code>dataSource</code>提供的数据动态更新视图了。</p>
<p>接下来就是开始干啦。</p>
<hr>
<h4 id="最后的最后"><a href="#最后的最后" class="headerlink" title="最后的最后"></a>最后的最后</h4><p>去除<code>tableview</code>的相关方法调用，附一张关于<code>ViewController</code>生命周期以及<code>self.view</code>上添加的子视图的生命周期，各个方法的调用时序截图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3190264-8f45840cd23d25d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="blog_pic_2.png"></p>
<p>蟹蟹围观。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/22/PHImageManager/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jaderyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jaderYang's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/22/PHImageManager/" itemprop="url">PHImageManage详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-22T18:24:00+08:00">
                2015-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>现在的App中，对照片和视频的操作非常频繁，如：各类软件个人图像的选取，社交软件照片及视频的分享，评论上图等。。</p>
<p>iOS8中更新的PHImageManager对于想要操控手机图片或视频的程序猿们无疑是最好的选择。</p>
<h4 id="获取手机照片并回显"><a href="#获取手机照片并回显" class="headerlink" title="获取手机照片并回显"></a>获取手机照片并回显</h4><p>大家都应该用过手机QQ，当我们要用QQ发送图片给小伙伴时，点击发送图片icon，QQ会非常贴心的将最近几张照片给我们呈现出来，供我们选择。用<code>PHImageManager</code>能很快的实现这样一个功能。在此做个简单的类似的实现：</p>
<ol>
<li><p>在项目build phase中添加Libraries Photos.framework 并在vc中引入头文件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Photos/Photos.h&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取访问照片权限</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)requestPermissons</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取当前状态：PHAuthorizationStatusNotDetermined--未知</span></span><br><span class="line">    <span class="comment">//            PHAuthorizationStatusRestricted--受限制的(用户不能更改某个App的此状态，或许某些活动限制设置能改变如：家长模式）</span></span><br><span class="line">    <span class="comment">//            PHAuthorizationStatusDenied--拒绝访问</span></span><br><span class="line">    <span class="comment">//            PHAuthorizationStatusAuthorized--可以访问</span></span><br><span class="line">    PHAuthorizationStatus status = [PHPhotoLibrary authorizationStatus];</span><br><span class="line">    __<span class="keyword">weak</span> RCCachingLocalImage *weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">if</span> (status == PHAuthorizationStatusNotDetermined) &#123;</span><br><span class="line">        [PHPhotoLibrary requestAuthorization:^(PHAuthorizationStatus status) &#123;</span><br><span class="line">            <span class="keyword">if</span> (status == PHAuthorizationStatusAuthorized) &#123;</span><br><span class="line">                <span class="comment">//获取手机照片库</span></span><br><span class="line">                <span class="comment">//[weakSelf loadImages];</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//弹出提示信息</span></span><br><span class="line">                [weakSelf alertMsg];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status == PHAuthorizationStatusAuthorized)&#123;</span><br><span class="line">        <span class="comment">//获取手机照片库</span></span><br><span class="line">        <span class="comment">//[self loadImages];</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//弹出提示信息</span></span><br><span class="line">        [<span class="keyword">self</span> alertMsg];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建这样一个场景:在当前<code>viewcontroller</code>中点击button 然后全屏显示最新拍摄的照片或者截屏图片。UI代码如下：</p>
<p>在Extension中定义全局变量</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">@interface</span>  <span class="title">RCCachingLocalImage</span>()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *assets;<span class="comment">//用于存储所有的照片。</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *showImgBnt;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imgView;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>然后再.m中加入</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span> requestPermissons];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UIButton</span> *navButton = [<span class="built_in">UIButton</span> new];</span><br><span class="line">    navButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">130</span>, <span class="built_in">CGRectGetHeight</span>(<span class="keyword">self</span>.view.frame) - <span class="number">200</span>,  <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.view.frame)<span class="number">-2</span>*<span class="number">130</span>, <span class="number">40</span>);</span><br><span class="line">    navButton.backgroundColor = [<span class="built_in">UIColor</span> blueColor];</span><br><span class="line">    [navButton setTitle:<span class="string">@"Show Image"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [navButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(showImage) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:navButton];</span><br><span class="line">    <span class="keyword">self</span>.showImgBtn = navButton;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [<span class="built_in">UIImageView</span> new];</span><br><span class="line">    imageView.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    imageView.frame = <span class="keyword">self</span>.view.frame;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    <span class="keyword">self</span>.imgView = imageView;</span><br><span class="line">    <span class="keyword">self</span>.imgView.hidden = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现showImage方法 显示图片，隐藏Button</p>
</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)showImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.showImgBnt.hidden = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.imgView.hidden = <span class="literal">NO</span>;</span><br><span class="line">    <span class="comment">//获取相册里所有的照片</span></span><br><span class="line">    PHFetchResult *result = [PHAsset fetchAssetsWithMediaType:PHAssetMediaTypeImage options:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">self</span>.assets = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">    [result enumerateObjectsUsingBlock:^(<span class="keyword">id</span>  _Nonnull obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([obj isKindOfClass:[PHAsset <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.assets addObject:obj];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="comment">//最后一张图为最新</span></span><br><span class="line">    PHAsset *asset = [<span class="keyword">self</span>.assets lastObject];</span><br><span class="line">    PHImageManager *manager = [PHImageManager defaultManager];</span><br><span class="line"></span><br><span class="line">    [manager requestImageForAsset:asset</span><br><span class="line">                       targetSize:PHImageManagerMaximumSize</span><br><span class="line">                      contentMode:PHImageContentModeAspectFill</span><br><span class="line">                          options:<span class="literal">nil</span></span><br><span class="line">                    resultHandler:^(<span class="built_in">UIImage</span> * _Nullable result, <span class="built_in">NSDictionary</span> * _Nullable info) &#123;</span><br><span class="line">                        [<span class="keyword">self</span>.imgView setImage:result];</span><br><span class="line">                    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有两个方法看着比较陌生<br>第一个：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (PHFetchResult&lt;PHAsset *&gt; *)fetchAssetsWithMediaType:(PHAssetMediaType)mediaType options:(<span class="keyword">nullable</span> PHFetchOptions *)options;</span><br></pre></td></tr></table></figure>
<p>该方法用作遍历资源库 返回特定类型的资源，mediaType可选四个值,对应关系分别为:</p>
<ul>
<li><code>PHAssetMediaTypeUnknown</code>–所有</li>
<li><code>PHAssetMediaTypeImage</code>–图片</li>
<li><code>PHAssetMediaTypeVideo</code>–视频  </li>
<li><code>PHAssetMediaTypeAudio</code>–音频</li>
<li><code>PHFetchResult</code>对应一组资源</li>
<li><code>PHAsset</code>对应单个资源</li>
<li><code>options</code>是搜索条件</li>
</ul>
<p>如：搜索自己喜爱的照片 并且按照时间上升顺序排列：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHFetchOptions *option = [[PHFetchOptions alloc] init];</span><br><span class="line">option.predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"favorite == YES"</span>];</span><br><span class="line">option.sortDescriptors = @[[<span class="built_in">NSSortDescriptor</span> sortDescriptorWithKey:<span class="string">@"creationDate"</span> ascending:<span class="literal">YES</span>]];</span><br><span class="line">PHFetchResult *result = [PHAsset fetchAssetsWithMediaType:PHAssetMediaTypeImage options:option];</span><br></pre></td></tr></table></figure>
<p>第二个：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (PHImageRequestID)requestImageForAsset:(PHAsset *)asset targetSize:(<span class="built_in">CGSize</span>)targetSize contentMode:(PHImageContentMode)contentMode options:(<span class="keyword">nullable</span> PHImageRequestOptions *)options resultHandler:(<span class="keyword">void</span> (^)(<span class="built_in">UIImage</span> *__<span class="keyword">nullable</span> result, <span class="built_in">NSDictionary</span> *__<span class="keyword">nullable</span> info))resultHandler;</span><br></pre></td></tr></table></figure>
<p>该方法用作获取特定的<code>PHAsset</code>所对应的图片,返回值为<code>PHImageRequestID</code>类型(实际上是32位int类型)的ID,可以用作取消加载还未加载完成的该请求。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cancelImageRequest:(PHImageRequestID)requestID;</span><br></pre></td></tr></table></figure>
<p>targetSize是你所需要返回的image尺寸,<code>PHImageManagerMaximumSize</code>为原图片尺寸<br>contentMode是如果原image尺寸与targetSize不相等，用哪种填充的mode，有两个可选值：<code>PHImageContentModeAspectFill</code>–缩放长宽完全填充<code>PHImageContentModeAspectFit</code>–只缩放长宽中比较大的那个，来等于targetSize。<br>options：定义请求方式，可为nil，下文会详细介绍，<br><code>resultHandler:block</code> 当image完全请求过来后调用。</p>
<p>现在 运行程序就能看到效果啦。</p>
<h4 id="获取图片并缓存"><a href="#获取图片并缓存" class="headerlink" title="获取图片并缓存"></a>获取图片并缓存</h4><p>如果需求为要在一个页面，同时显示大量图片，for循环调用上诉方法肯定是不行的，<code>requestImageForAsset</code>会有延时，而达到这一效果，我们可以先缓存下来所有的图片，然后用<code>requestImageForAsset</code>,根据<code>PHImageManage</code>的加载机制，能做到同时显示。<br>缓存图片方法代码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)loadImages</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"loadImages"</span>);</span><br><span class="line">    PHFetchResult *result = [PHAsset fetchAssetsWithMediaType:PHAssetMediaTypeImage options:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>,[result count]);</span><br><span class="line">    <span class="keyword">self</span>.assets = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">    [result enumerateObjectsUsingBlock:^(<span class="keyword">id</span>  _Nonnull obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([obj isKindOfClass:[PHAsset <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.assets addObject:obj];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    PHCachingImageManager *cachingImage = [[PHCachingImageManager alloc] init];</span><br><span class="line">    [cachingImage startCachingImagesForAssets:<span class="keyword">self</span>.assets</span><br><span class="line">                                   targetSize:PHImageManagerMaximumSize</span><br><span class="line">                                  contentMode:PHImageContentModeAspectFit</span><br><span class="line">                                      options:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过此缓存后,再用<code>RequestImageForAsset:targetSize:contentMode:options:resultHandler:</code>方法时便能直接从缓存中加载image，从而直接执行resultHandler内的block,特别注意，无延时加载的前提条件是，此时的targetSize 与 缓存时的targetSize必须一样，不然此方法会去图片库重新请求资源加载成image而不会走缓存。</p>
<h4 id="图片请求回显方式详解-PHImageRequestOptions"><a href="#图片请求回显方式详解-PHImageRequestOptions" class="headerlink" title="图片请求回显方式详解 PHImageRequestOptions"></a>图片请求回显方式详解 PHImageRequestOptions</h4><p>之前的RequestImageForAsset 和 startCachingImagesForAssets两个方法中 option都设置的是nil。PHImageRequestOptions是用来控制加载什么一级用什么样的方式。下面介绍其主要属性：</p>
<ul>
<li>networkAccessAllowed <em>Bool</em>    如果需要，是否允许从iCloud下载图片。</li>
<li>normalizedCropRect <em>CGRect</em>    指定一个rect来截取原图片,rect以原图片为坐标系。</li>
<li>synchronous <em>Bool</em> 同步加载。默认是NO。(只有当resultHandler block执行完后 该方法才执行完毕)。</li>
<li>deliveryMode <em>PHImageRequestOptionsDeliveryMode</em></li>
<li>PHImageRequestOptionsDeliveryMode是一个enum类型的，它囊括了非常复杂的操作，有三个值分别对应：</li>
</ul>
<ul>
<li><code>PHImageRequestOptionsDeliveryModeOpportunistic</code> 当选用此项时，Photos会在你请求时给你提供一个或者多个结果，这就意味着resultHandler block可能会执行一次或多次，例如<br>Photos会先给你一个低分辨率的图片让你暂时显示，然后加载出高质量的图片后再次给你。如果PHImageManager已经pre-cache了图片，那result handler便只会执行一次。另外，如果synchronous属性为NO,此选项是不起作用的。</li>
<li><code>PHImageRequestOptionsDeliveryModeHighQualityFormat</code>当请求image时 不管请求需要多长时间完成，Photos只会提供高质量的image。另外，当synhronous属性为YES 或者使用requestImageDataForAsset:options:resultHandler: 方法时，这个选项是默认且唯一的。</li>
<li><code>PHImageRequestOptionsDeliveryModeFastFormat</code> 当请求image时，高质量的图片或低质量的图片，谁加载的快 便显示谁。另外Photos也能通过检查info字典(<code>resultHandler</code>中的参数)里的<code>PHImageResultIsDegradedKey</code>值来判定传高质量或者低质量的图片。</li>
</ul>
<p>之前运行时，应该能发现 在图片出现前会有短暂的图片背景色显示。现在我们加上option后再请求图片：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)showImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.showImgBnt.hidden = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.imgView.hidden = <span class="literal">NO</span>;</span><br><span class="line">    PHAsset *asset = [<span class="keyword">self</span>.assets firstObject];</span><br><span class="line">    PHImageManager *manager = [PHImageManager defaultManager];</span><br><span class="line">    PHImageRequestOptions *option = [[PHImageRequestOptions alloc] init];</span><br><span class="line">    option.deliveryMode = PHImageRequestOptionsDeliveryModeHighQualityFormat;</span><br><span class="line">    option.synchronous = <span class="literal">YES</span>;</span><br><span class="line">    [manager requestImageForAsset:asset</span><br><span class="line">                       targetSize:PHImageManagerMaximumSize</span><br><span class="line">                      contentMode:PHImageContentModeAspectFill options:option</span><br><span class="line">                    resultHandler:^(<span class="built_in">UIImage</span> * _Nullable result, <span class="built_in">NSDictionary</span> * _Nullable info) &#123;</span><br><span class="line">                        [<span class="keyword">self</span>.imgView setImage:result];</span><br><span class="line">                    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时便不会有那个问题了。</p>
<p>ps:关于<code>PHImageRequestOptionsDeliveryMode</code> <code>enum</code>中值的意思我是翻译的Apple官方文档，其中有一个逻辑错误就是，按照官方文档逻辑来看，在任何情况下<code>PHImageRequestOptionsDeliveryModeOpportunistic</code>属性都不会起作用。对此问题我也google过，然后发现mattt大大的文章中也是直接搬过来的，在Twitter上问了他，问题确实存在，以下是我与他的私信过程：<br><img src="http://img.blog.csdn.net/20151222202853081" alt="这里写图片描述"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="jaderyang" />
          <p class="site-author-name" itemprop="name">jaderyang</p>
           
              <p class="site-description motion-element" itemprop="description">乘风破浪会有时,直挂云帆济沧海</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jaderyang</span>
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<div class="theme-info">
  <span class="post-count">博客全站共9.1k字</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
